@model WebApp.ViewModels.InterventionNotesViewModel

@{
    ViewBag.Title = "InterventionNotes";
    var intervention = Model.Intervention;
    Layout = "_Layout";
}

<div class="notes-card-body">
    <h1 class="notes-card-header m-3">Notes pour l'intervention : ID @intervention.Id</h1>

    <div class="col-6 text-end">
    </div>

    <a asp-action="Create" asp-route-interventionId="@intervention.Id" class="btn btn-primary custom-btn custom-btn-create m-3"><i class="bi bi-sticky-fill"></i> Ajouter une note</a>
    <a asp-action="Details" asp-controller="Intervention" asp-route-id="@intervention.Id" class="btn btn-secondary custom-btn custom-btn-create"><i class="bi bi-arrow-90deg-left"></i> Retour</a>

    <div class="notes-container mt-3">
        @foreach (var note in Model.InterventionNotes)
        {
            // Utilisation de la méthode pour obtenir le nom d'utilisateur basé sur l'ID de l'employé qui a créé la note
            var employeeName = @Model.GetEmployeeUsernameByEmployeeId(note.IdEmployee);
            bool isCurrentUser = employeeName == User.Identity.Name;

            <div class="note @(isCurrentUser ? "note-current-user" : "note-other-user")">
                <div class="note-header">
                    <strong>@(isCurrentUser ? "Vous" : employeeName)</strong> : @note.CreatedDate?.ToString("dd/MM/yyyy hh:mm tt")
                </div>
                <div class="note-body">
                    <p>@note.Comment</p>
                </div>
                <div class="note-actions">
                    @if (isCurrentUser)
                    {
                        <a asp-action="Edit" asp-route-id="@note.Id" class="btn btn-sm btn-primary custom-btn custom-btn-edit"><i class="bi bi-pencil-square"></i> </a>
                        <a asp-action="Delete" asp-route-id="@note.Id" class="btn btn-sm btn-danger custom-btn custom-btn-delete"><i class="bi bi-trash-fill"></i> </a>
                    }
                </div>
            </div>
        }
    </div>
</div>
